// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package components

import (
	"errors"
	"fmt"
	"github.com/speakeasy-api/gram/responses/internal/utils"
)

type ToolChoiceParamType string

const (
	ToolChoiceParamTypeSpecificToolChoiceParam ToolChoiceParamType = "SpecificToolChoiceParam"
	ToolChoiceParamTypeToolChoiceValueEnum     ToolChoiceParamType = "ToolChoiceValueEnum"
	ToolChoiceParamTypeAllowedToolsParam       ToolChoiceParamType = "AllowedToolsParam"
)

// ToolChoiceParam - Controls which tool the model should use, if any.
type ToolChoiceParam struct {
	SpecificToolChoiceParam *SpecificToolChoiceParam `queryParam:"inline" union:"member"`
	ToolChoiceValueEnum     *ToolChoiceValueEnum     `queryParam:"inline" union:"member"`
	AllowedToolsParam       *AllowedToolsParam       `queryParam:"inline" union:"member"`

	Type ToolChoiceParamType
}

func CreateToolChoiceParamSpecificToolChoiceParam(specificToolChoiceParam SpecificToolChoiceParam) ToolChoiceParam {
	typ := ToolChoiceParamTypeSpecificToolChoiceParam

	return ToolChoiceParam{
		SpecificToolChoiceParam: &specificToolChoiceParam,
		Type:                    typ,
	}
}

func CreateToolChoiceParamToolChoiceValueEnum(toolChoiceValueEnum ToolChoiceValueEnum) ToolChoiceParam {
	typ := ToolChoiceParamTypeToolChoiceValueEnum

	return ToolChoiceParam{
		ToolChoiceValueEnum: &toolChoiceValueEnum,
		Type:                typ,
	}
}

func CreateToolChoiceParamAllowedToolsParam(allowedToolsParam AllowedToolsParam) ToolChoiceParam {
	typ := ToolChoiceParamTypeAllowedToolsParam

	return ToolChoiceParam{
		AllowedToolsParam: &allowedToolsParam,
		Type:              typ,
	}
}

func (u *ToolChoiceParam) UnmarshalJSON(data []byte) error {

	var candidates []utils.UnionCandidate

	// Collect all valid candidates
	var specificToolChoiceParam SpecificToolChoiceParam = SpecificToolChoiceParam{}
	if err := utils.UnmarshalJSON(data, &specificToolChoiceParam, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ToolChoiceParamTypeSpecificToolChoiceParam,
			Value: &specificToolChoiceParam,
		})
	}

	var toolChoiceValueEnum ToolChoiceValueEnum = ToolChoiceValueEnum("")
	if err := utils.UnmarshalJSON(data, &toolChoiceValueEnum, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ToolChoiceParamTypeToolChoiceValueEnum,
			Value: &toolChoiceValueEnum,
		})
	}

	var allowedToolsParam AllowedToolsParam = AllowedToolsParam{}
	if err := utils.UnmarshalJSON(data, &allowedToolsParam, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ToolChoiceParamTypeAllowedToolsParam,
			Value: &allowedToolsParam,
		})
	}

	if len(candidates) == 0 {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for ToolChoiceParam", string(data))
	}

	// Pick the best candidate using multi-stage filtering
	best := utils.PickBestUnionCandidate(candidates, data)
	if best == nil {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for ToolChoiceParam", string(data))
	}

	// Set the union type and value based on the best candidate
	u.Type = best.Type.(ToolChoiceParamType)
	switch best.Type {
	case ToolChoiceParamTypeSpecificToolChoiceParam:
		u.SpecificToolChoiceParam = best.Value.(*SpecificToolChoiceParam)
		return nil
	case ToolChoiceParamTypeToolChoiceValueEnum:
		u.ToolChoiceValueEnum = best.Value.(*ToolChoiceValueEnum)
		return nil
	case ToolChoiceParamTypeAllowedToolsParam:
		u.AllowedToolsParam = best.Value.(*AllowedToolsParam)
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for ToolChoiceParam", string(data))
}

func (u ToolChoiceParam) MarshalJSON() ([]byte, error) {
	if u.SpecificToolChoiceParam != nil {
		return utils.MarshalJSON(u.SpecificToolChoiceParam, "", true)
	}

	if u.ToolChoiceValueEnum != nil {
		return utils.MarshalJSON(u.ToolChoiceValueEnum, "", true)
	}

	if u.AllowedToolsParam != nil {
		return utils.MarshalJSON(u.AllowedToolsParam, "", true)
	}

	return nil, errors.New("could not marshal union type ToolChoiceParam: all fields are null")
}
