// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package components

import (
	"errors"
	"fmt"
	"github.com/speakeasy-api/gram/responses/internal/utils"
)

type ItemFieldType string

const (
	ItemFieldTypeMessage            ItemFieldType = "Message"
	ItemFieldTypeFunctionCall       ItemFieldType = "FunctionCall"
	ItemFieldTypeFunctionCallOutput ItemFieldType = "FunctionCallOutput"
	ItemFieldTypeReasoningBody      ItemFieldType = "ReasoningBody"
)

// ItemField - An item representing a message, tool call, tool output, reasoning, or other response element.
type ItemField struct {
	Message            *Message            `queryParam:"inline" union:"member"`
	FunctionCall       *FunctionCall       `queryParam:"inline" union:"member"`
	FunctionCallOutput *FunctionCallOutput `queryParam:"inline" union:"member"`
	ReasoningBody      *ReasoningBody      `queryParam:"inline" union:"member"`

	Type ItemFieldType
}

func CreateItemFieldMessage(message Message) ItemField {
	typ := ItemFieldTypeMessage

	return ItemField{
		Message: &message,
		Type:    typ,
	}
}

func CreateItemFieldFunctionCall(functionCall FunctionCall) ItemField {
	typ := ItemFieldTypeFunctionCall

	return ItemField{
		FunctionCall: &functionCall,
		Type:         typ,
	}
}

func CreateItemFieldFunctionCallOutput(functionCallOutput FunctionCallOutput) ItemField {
	typ := ItemFieldTypeFunctionCallOutput

	return ItemField{
		FunctionCallOutput: &functionCallOutput,
		Type:               typ,
	}
}

func CreateItemFieldReasoningBody(reasoningBody ReasoningBody) ItemField {
	typ := ItemFieldTypeReasoningBody

	return ItemField{
		ReasoningBody: &reasoningBody,
		Type:          typ,
	}
}

func (u *ItemField) UnmarshalJSON(data []byte) error {

	var candidates []utils.UnionCandidate

	// Collect all valid candidates
	var message Message = Message{}
	if err := utils.UnmarshalJSON(data, &message, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ItemFieldTypeMessage,
			Value: &message,
		})
	}

	var functionCall FunctionCall = FunctionCall{}
	if err := utils.UnmarshalJSON(data, &functionCall, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ItemFieldTypeFunctionCall,
			Value: &functionCall,
		})
	}

	var functionCallOutput FunctionCallOutput = FunctionCallOutput{}
	if err := utils.UnmarshalJSON(data, &functionCallOutput, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ItemFieldTypeFunctionCallOutput,
			Value: &functionCallOutput,
		})
	}

	var reasoningBody ReasoningBody = ReasoningBody{}
	if err := utils.UnmarshalJSON(data, &reasoningBody, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ItemFieldTypeReasoningBody,
			Value: &reasoningBody,
		})
	}

	if len(candidates) == 0 {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for ItemField", string(data))
	}

	// Pick the best candidate using multi-stage filtering
	best := utils.PickBestUnionCandidate(candidates, data)
	if best == nil {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for ItemField", string(data))
	}

	// Set the union type and value based on the best candidate
	u.Type = best.Type.(ItemFieldType)
	switch best.Type {
	case ItemFieldTypeMessage:
		u.Message = best.Value.(*Message)
		return nil
	case ItemFieldTypeFunctionCall:
		u.FunctionCall = best.Value.(*FunctionCall)
		return nil
	case ItemFieldTypeFunctionCallOutput:
		u.FunctionCallOutput = best.Value.(*FunctionCallOutput)
		return nil
	case ItemFieldTypeReasoningBody:
		u.ReasoningBody = best.Value.(*ReasoningBody)
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for ItemField", string(data))
}

func (u ItemField) MarshalJSON() ([]byte, error) {
	if u.Message != nil {
		return utils.MarshalJSON(u.Message, "", true)
	}

	if u.FunctionCall != nil {
		return utils.MarshalJSON(u.FunctionCall, "", true)
	}

	if u.FunctionCallOutput != nil {
		return utils.MarshalJSON(u.FunctionCallOutput, "", true)
	}

	if u.ReasoningBody != nil {
		return utils.MarshalJSON(u.ReasoningBody, "", true)
	}

	return nil, errors.New("could not marshal union type ItemField: all fields are null")
}
