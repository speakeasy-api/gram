overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Fix Tool discriminated union types
  version: 0.0.0
actions:
  # Remove default Tool schema (Goa's custom union encoding)
  - target: $.components.schemas.Tool.properties
    remove: true

  # Replace Tool with proper oneOf discriminated union
  - target: $.components.schemas.Tool
    update:
      description: A polymorphic tool - can be an HTTP tool or a prompt template
      oneOf:
        - $ref: "#/components/schemas/HTTPToolDefinition"
        - $ref: "#/components/schemas/PromptTemplate"
      discriminator:
        propertyName: type
        mapping:
          http: "#/components/schemas/HTTPToolDefinition"
          prompt: "#/components/schemas/PromptTemplate"

  # Add tool_type field to HTTPToolDefinition for discriminator
  - target: $.components.schemas.HTTPToolDefinition
    update:
      x-speakeasy-entity: HTTPToolDefinition
      properties:
        type:
          type: string
          description: The type of the tool - discriminator value
          enum:
            - http

  # Add tool_type field to PromptTemplate for discriminator
  - target: $.components.schemas.PromptTemplate.properties
    update:
      type:
        type: string
        description: The type of the tool - discriminator value
        enum:
          - prompt
