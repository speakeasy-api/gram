name: Migrations
on:
  push:
    branches:
      - main
    paths:
      - .github/workflows/migrations.yaml
      - 'server/migrations/*'
  pull_request:
    paths:
      - 'server/migrations/*'

jobs:
  lint:
    runs-on: ubicloud-standard-4
    steps:
      - name: Checkout
        uses: actions/checkout@ff7abcd0c3c05ccf6adc123a8cd1fd4fb30fb493 # v5.0.0
        with:
          fetch-depth: 0
      - name: Setup Mise
        uses: jdx/mise-action@5ac50f778e26fac95da98d50503682459e86d566 # v3.2.0
        with:
          install: true
          cache: true
          env: false
      - name: Prepare GitHub Actions environment
        run: mise run github
      - name: Lint migrations
        run: |
          mise run lint:migrations \
            --github-token ${{ github.token }} \
            --github-event-path ${{ github.event_path }}