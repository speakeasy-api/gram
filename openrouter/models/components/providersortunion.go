// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package components

import (
	"errors"
	"fmt"
	"github.com/speakeasy-api/gram/openrouter/internal/utils"
)

type ProviderSortUnionType string

const (
	ProviderSortUnionTypeProviderSort       ProviderSortUnionType = "ProviderSort"
	ProviderSortUnionTypeProviderSortConfig ProviderSortUnionType = "ProviderSortConfig"
)

type ProviderSortUnion struct {
	ProviderSort       *ProviderSort       `queryParam:"inline" union:"member"`
	ProviderSortConfig *ProviderSortConfig `queryParam:"inline" union:"member"`

	Type ProviderSortUnionType
}

func CreateProviderSortUnionProviderSort(providerSort ProviderSort) ProviderSortUnion {
	typ := ProviderSortUnionTypeProviderSort

	return ProviderSortUnion{
		ProviderSort: &providerSort,
		Type:         typ,
	}
}

func CreateProviderSortUnionProviderSortConfig(providerSortConfig ProviderSortConfig) ProviderSortUnion {
	typ := ProviderSortUnionTypeProviderSortConfig

	return ProviderSortUnion{
		ProviderSortConfig: &providerSortConfig,
		Type:               typ,
	}
}

func (u *ProviderSortUnion) UnmarshalJSON(data []byte) error {

	var candidates []utils.UnionCandidate

	// Collect all valid candidates
	var providerSort ProviderSort = ProviderSort("")
	if err := utils.UnmarshalJSON(data, &providerSort, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ProviderSortUnionTypeProviderSort,
			Value: &providerSort,
		})
	}

	var providerSortConfig ProviderSortConfig = ProviderSortConfig{}
	if err := utils.UnmarshalJSON(data, &providerSortConfig, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  ProviderSortUnionTypeProviderSortConfig,
			Value: &providerSortConfig,
		})
	}

	if len(candidates) == 0 {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for ProviderSortUnion", string(data))
	}

	// Pick the best candidate using multi-stage filtering
	best := utils.PickBestUnionCandidate(candidates, data)
	if best == nil {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for ProviderSortUnion", string(data))
	}

	// Set the union type and value based on the best candidate
	u.Type = best.Type.(ProviderSortUnionType)
	switch best.Type {
	case ProviderSortUnionTypeProviderSort:
		u.ProviderSort = best.Value.(*ProviderSort)
		return nil
	case ProviderSortUnionTypeProviderSortConfig:
		u.ProviderSortConfig = best.Value.(*ProviderSortConfig)
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for ProviderSortUnion", string(data))
}

func (u ProviderSortUnion) MarshalJSON() ([]byte, error) {
	if u.ProviderSort != nil {
		return utils.MarshalJSON(u.ProviderSort, "", true)
	}

	if u.ProviderSortConfig != nil {
		return utils.MarshalJSON(u.ProviderSortConfig, "", true)
	}

	return nil, errors.New("could not marshal union type ProviderSortUnion: all fields are null")
}
