// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package components

import (
	"errors"
	"fmt"
	"github.com/speakeasy-api/gram/openrouter/internal/utils"
	"github.com/speakeasy-api/gram/openrouter/optionalnullable"
)

type AssistantMessageContentType string

const (
	AssistantMessageContentTypeStr                           AssistantMessageContentType = "str"
	AssistantMessageContentTypeArrayOfChatMessageContentItem AssistantMessageContentType = "arrayOfChatMessageContentItem"
)

type AssistantMessageContent struct {
	Str                           *string                  `queryParam:"inline" union:"member"`
	ArrayOfChatMessageContentItem []ChatMessageContentItem `queryParam:"inline" union:"member"`

	Type AssistantMessageContentType
}

func CreateAssistantMessageContentStr(str string) AssistantMessageContent {
	typ := AssistantMessageContentTypeStr

	return AssistantMessageContent{
		Str:  &str,
		Type: typ,
	}
}

func CreateAssistantMessageContentArrayOfChatMessageContentItem(arrayOfChatMessageContentItem []ChatMessageContentItem) AssistantMessageContent {
	typ := AssistantMessageContentTypeArrayOfChatMessageContentItem

	return AssistantMessageContent{
		ArrayOfChatMessageContentItem: arrayOfChatMessageContentItem,
		Type:                          typ,
	}
}

func (u *AssistantMessageContent) UnmarshalJSON(data []byte) error {

	var candidates []utils.UnionCandidate

	// Collect all valid candidates
	var str string = ""
	if err := utils.UnmarshalJSON(data, &str, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  AssistantMessageContentTypeStr,
			Value: &str,
		})
	}

	var arrayOfChatMessageContentItem []ChatMessageContentItem = []ChatMessageContentItem{}
	if err := utils.UnmarshalJSON(data, &arrayOfChatMessageContentItem, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  AssistantMessageContentTypeArrayOfChatMessageContentItem,
			Value: arrayOfChatMessageContentItem,
		})
	}

	if len(candidates) == 0 {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for AssistantMessageContent", string(data))
	}

	// Pick the best candidate using multi-stage filtering
	best := utils.PickBestUnionCandidate(candidates, data)
	if best == nil {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for AssistantMessageContent", string(data))
	}

	// Set the union type and value based on the best candidate
	u.Type = best.Type.(AssistantMessageContentType)
	switch best.Type {
	case AssistantMessageContentTypeStr:
		u.Str = best.Value.(*string)
		return nil
	case AssistantMessageContentTypeArrayOfChatMessageContentItem:
		u.ArrayOfChatMessageContentItem = best.Value.([]ChatMessageContentItem)
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for AssistantMessageContent", string(data))
}

func (u AssistantMessageContent) MarshalJSON() ([]byte, error) {
	if u.Str != nil {
		return utils.MarshalJSON(u.Str, "", true)
	}

	if u.ArrayOfChatMessageContentItem != nil {
		return utils.MarshalJSON(u.ArrayOfChatMessageContentItem, "", true)
	}

	return nil, errors.New("could not marshal union type AssistantMessageContent: all fields are null")
}

type AssistantMessageImageURL struct {
	URL string `json:"url"`
}

func (a AssistantMessageImageURL) MarshalJSON() ([]byte, error) {
	return utils.MarshalJSON(a, "", false)
}

func (a *AssistantMessageImageURL) UnmarshalJSON(data []byte) error {
	if err := utils.UnmarshalJSON(data, &a, "", false, nil); err != nil {
		return err
	}
	return nil
}

func (a *AssistantMessageImageURL) GetURL() string {
	if a == nil {
		return ""
	}
	return a.URL
}

type Image struct {
	ImageURL AssistantMessageImageURL `json:"image_url"`
}

func (i Image) MarshalJSON() ([]byte, error) {
	return utils.MarshalJSON(i, "", false)
}

func (i *Image) UnmarshalJSON(data []byte) error {
	if err := utils.UnmarshalJSON(data, &i, "", false, nil); err != nil {
		return err
	}
	return nil
}

func (i *Image) GetImageURL() AssistantMessageImageURL {
	if i == nil {
		return AssistantMessageImageURL{}
	}
	return i.ImageURL
}

type AssistantMessage struct {
	role             string                                                     `const:"assistant" json:"role"`
	Content          optionalnullable.OptionalNullable[AssistantMessageContent] `json:"content,omitzero"`
	Name             *string                                                    `json:"name,omitzero"`
	ToolCalls        []ChatMessageToolCall                                      `json:"tool_calls,omitzero"`
	Refusal          optionalnullable.OptionalNullable[string]                  `json:"refusal,omitzero"`
	Reasoning        optionalnullable.OptionalNullable[string]                  `json:"reasoning,omitzero"`
	ReasoningDetails []Schema2                                                  `json:"reasoning_details,omitzero"`
	Images           []Image                                                    `json:"images,omitzero"`
}

func (a AssistantMessage) MarshalJSON() ([]byte, error) {
	return utils.MarshalJSON(a, "", false)
}

func (a *AssistantMessage) UnmarshalJSON(data []byte) error {
	if err := utils.UnmarshalJSON(data, &a, "", false, nil); err != nil {
		return err
	}
	return nil
}

func (a *AssistantMessage) GetRole() string {
	return "assistant"
}

func (a *AssistantMessage) GetContent() optionalnullable.OptionalNullable[AssistantMessageContent] {
	if a == nil {
		return nil
	}
	return a.Content
}

func (a *AssistantMessage) GetName() *string {
	if a == nil {
		return nil
	}
	return a.Name
}

func (a *AssistantMessage) GetToolCalls() []ChatMessageToolCall {
	if a == nil {
		return nil
	}
	return a.ToolCalls
}

func (a *AssistantMessage) GetRefusal() optionalnullable.OptionalNullable[string] {
	if a == nil {
		return nil
	}
	return a.Refusal
}

func (a *AssistantMessage) GetReasoning() optionalnullable.OptionalNullable[string] {
	if a == nil {
		return nil
	}
	return a.Reasoning
}

func (a *AssistantMessage) GetReasoningDetails() []Schema2 {
	if a == nil {
		return nil
	}
	return a.ReasoningDetails
}

func (a *AssistantMessage) GetImages() []Image {
	if a == nil {
		return nil
	}
	return a.Images
}
