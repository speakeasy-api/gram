-- Modify "organization_metadata" table
ALTER TABLE "organization_metadata" ADD COLUMN "sso_connection_id" text NULL;
-- Modify "users" table
ALTER TABLE "users" ADD COLUMN "last_login" timestamptz NULL;
-- Create "organization_user_relationship" table
CREATE TABLE "organization_user_relationship" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "organization_id" text NOT NULL,
  "user_id" text NOT NULL,
  "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(),
  "updated_at" timestamptz NOT NULL DEFAULT clock_timestamp(),
  "deleted_at" timestamptz NULL,
  "deleted" boolean NOT NULL GENERATED ALWAYS AS (deleted_at IS NOT NULL) STORED,
  PRIMARY KEY ("id"),
  CONSTRAINT "organization_user_relationship_organization_id_user_id_key" UNIQUE ("organization_id", "user_id"),
  CONSTRAINT "organization_user_relationship_organization_id_fkey" FOREIGN KEY ("organization_id") REFERENCES "organization_metadata" ("id") ON UPDATE NO ACTION ON DELETE SET NULL,
  CONSTRAINT "organization_user_relationship_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE SET NULL
);
