-- Create "functions_access" table
CREATE TABLE "functions_access" ("id" uuid NOT NULL DEFAULT generate_uuidv7(), "seq" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "project_id" uuid NOT NULL, "deployment_id" uuid NOT NULL, "function_id" uuid NOT NULL, "encryption_key" bytea NULL, "bearer_format" text NULL, "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "updated_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "deleted_at" timestamptz NULL, "deleted" boolean NOT NULL GENERATED ALWAYS AS (deleted_at IS NOT NULL) STORED, CONSTRAINT "functions_mtls_pkey" PRIMARY KEY ("id"), CONSTRAINT "functions_mtls_deployment_id_fkey" FOREIGN KEY ("deployment_id") REFERENCES "deployments" ("id") ON UPDATE NO ACTION ON DELETE CASCADE, CONSTRAINT "functions_mtls_function_id_fkey" FOREIGN KEY ("function_id") REFERENCES "deployments_functions" ("id") ON UPDATE NO ACTION ON DELETE CASCADE);
-- Create index "functions_access_project_deployment_function_seq_key" to table: "functions_access"
CREATE UNIQUE INDEX "functions_access_project_deployment_function_seq_key" ON "functions_access" ("project_id", "deployment_id", "function_id", "seq" DESC) WHERE (deleted IS FALSE);
