-- Create "toolset_versions" table
CREATE TABLE "toolset_versions" ("id" uuid NOT NULL DEFAULT generate_uuidv7(), "toolset_id" uuid NOT NULL, "version" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY, "tool_urns" text[] NOT NULL DEFAULT ARRAY[]::text[], "predecessor_id" uuid NULL, "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "updated_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "deleted_at" timestamptz NULL, "deleted" boolean NOT NULL GENERATED ALWAYS AS (deleted_at IS NOT NULL) STORED, PRIMARY KEY ("id"), CONSTRAINT "toolset_versions_version_toolset_id_key" UNIQUE ("version", "toolset_id"), CONSTRAINT "toolset_versions_predecessor_id_fkey" FOREIGN KEY ("predecessor_id") REFERENCES "toolset_versions" ("id") ON UPDATE NO ACTION ON DELETE SET NULL, CONSTRAINT "toolset_versions_toolset_id_fkey" FOREIGN KEY ("toolset_id") REFERENCES "toolsets" ("id") ON UPDATE NO ACTION ON DELETE CASCADE);
-- Create index "toolset_versions_toolset_id_version_idx" to table: "toolset_versions"
CREATE INDEX "toolset_versions_toolset_id_version_idx" ON "toolset_versions" ("toolset_id", "version" DESC);
