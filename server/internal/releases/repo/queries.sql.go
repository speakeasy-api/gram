// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: queries.sql

package repo

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const countReleases = `-- name: CountReleases :one
SELECT COUNT(*)
FROM toolset_releases
WHERE toolset_id = $1
`

func (q *Queries) CountReleases(ctx context.Context, toolsetID uuid.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, countReleases, toolsetID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createRelease = `-- name: CreateRelease :one
INSERT INTO toolset_releases (
    toolset_id
  , source_state_id
  , toolset_version_id
  , global_variations_version_id
  , toolset_variations_version_id
  , release_number
  , notes
  , released_by_user_id
) VALUES (
    $1
  , $2
  , $3
  , $4
  , $5
  , COALESCE(
      (SELECT MAX(release_number) + 1 FROM toolset_releases WHERE toolset_id = $1),
      1
    )
  , $6
  , $7
)
RETURNING id, toolset_id, source_state_id, toolset_version_id, global_variations_version_id, toolset_variations_version_id, release_number, notes, released_by_user_id, created_at
`

type CreateReleaseParams struct {
	ToolsetID                  uuid.UUID
	SourceStateID              uuid.NullUUID
	ToolsetVersionID           uuid.UUID
	GlobalVariationsVersionID  uuid.NullUUID
	ToolsetVariationsVersionID uuid.NullUUID
	Notes                      pgtype.Text
	ReleasedByUserID           string
}

func (q *Queries) CreateRelease(ctx context.Context, arg CreateReleaseParams) (ToolsetRelease, error) {
	row := q.db.QueryRow(ctx, createRelease,
		arg.ToolsetID,
		arg.SourceStateID,
		arg.ToolsetVersionID,
		arg.GlobalVariationsVersionID,
		arg.ToolsetVariationsVersionID,
		arg.Notes,
		arg.ReleasedByUserID,
	)
	var i ToolsetRelease
	err := row.Scan(
		&i.ID,
		&i.ToolsetID,
		&i.SourceStateID,
		&i.ToolsetVersionID,
		&i.GlobalVariationsVersionID,
		&i.ToolsetVariationsVersionID,
		&i.ReleaseNumber,
		&i.Notes,
		&i.ReleasedByUserID,
		&i.CreatedAt,
	)
	return i, err
}

const createSourceState = `-- name: CreateSourceState :one
INSERT INTO source_states (
    project_id
  , deployment_id
  , system_source_state_id
) VALUES (
    $1
  , $2
  , $3
)
RETURNING id, project_id, deployment_id, system_source_state_id, created_at
`

type CreateSourceStateParams struct {
	ProjectID           uuid.UUID
	DeploymentID        uuid.UUID
	SystemSourceStateID uuid.UUID
}

func (q *Queries) CreateSourceState(ctx context.Context, arg CreateSourceStateParams) (SourceState, error) {
	row := q.db.QueryRow(ctx, createSourceState, arg.ProjectID, arg.DeploymentID, arg.SystemSourceStateID)
	var i SourceState
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.DeploymentID,
		&i.SystemSourceStateID,
		&i.CreatedAt,
	)
	return i, err
}

const createSystemSourceState = `-- name: CreateSystemSourceState :one
INSERT INTO system_source_states (
    project_id
  , prompt_template_ids
) VALUES (
    $1
  , $2
)
RETURNING id, project_id, prompt_template_ids, created_at
`

type CreateSystemSourceStateParams struct {
	ProjectID         uuid.UUID
	PromptTemplateIds []uuid.UUID
}

func (q *Queries) CreateSystemSourceState(ctx context.Context, arg CreateSystemSourceStateParams) (SystemSourceState, error) {
	row := q.db.QueryRow(ctx, createSystemSourceState, arg.ProjectID, arg.PromptTemplateIds)
	var i SystemSourceState
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.PromptTemplateIds,
		&i.CreatedAt,
	)
	return i, err
}

const createToolVariationsGroupVersion = `-- name: CreateToolVariationsGroupVersion :one
INSERT INTO tool_variations_group_versions (
    group_id
  , version
  , variation_ids
  , predecessor_id
) VALUES (
    $1
  , COALESCE(
      (SELECT MAX(version) + 1 FROM tool_variations_group_versions WHERE group_id = $1),
      1
    )
  , $2
  , $3
)
RETURNING id, group_id, version, variation_ids, predecessor_id, created_at
`

type CreateToolVariationsGroupVersionParams struct {
	GroupID       uuid.UUID
	VariationIds  []uuid.UUID
	PredecessorID uuid.NullUUID
}

func (q *Queries) CreateToolVariationsGroupVersion(ctx context.Context, arg CreateToolVariationsGroupVersionParams) (ToolVariationsGroupVersion, error) {
	row := q.db.QueryRow(ctx, createToolVariationsGroupVersion, arg.GroupID, arg.VariationIds, arg.PredecessorID)
	var i ToolVariationsGroupVersion
	err := row.Scan(
		&i.ID,
		&i.GroupID,
		&i.Version,
		&i.VariationIds,
		&i.PredecessorID,
		&i.CreatedAt,
	)
	return i, err
}

const deleteRelease = `-- name: DeleteRelease :exec
DELETE FROM toolset_releases
WHERE id = $1
`

func (q *Queries) DeleteRelease(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteRelease, id)
	return err
}

const getLatestRelease = `-- name: GetLatestRelease :one
SELECT id, toolset_id, source_state_id, toolset_version_id, global_variations_version_id, toolset_variations_version_id, release_number, notes, released_by_user_id, created_at
FROM toolset_releases
WHERE toolset_id = $1
ORDER BY release_number DESC
LIMIT 1
`

func (q *Queries) GetLatestRelease(ctx context.Context, toolsetID uuid.UUID) (ToolsetRelease, error) {
	row := q.db.QueryRow(ctx, getLatestRelease, toolsetID)
	var i ToolsetRelease
	err := row.Scan(
		&i.ID,
		&i.ToolsetID,
		&i.SourceStateID,
		&i.ToolsetVersionID,
		&i.GlobalVariationsVersionID,
		&i.ToolsetVariationsVersionID,
		&i.ReleaseNumber,
		&i.Notes,
		&i.ReleasedByUserID,
		&i.CreatedAt,
	)
	return i, err
}

const getLatestToolVariationsGroupVersion = `-- name: GetLatestToolVariationsGroupVersion :one
SELECT id, group_id, version, variation_ids, predecessor_id, created_at
FROM tool_variations_group_versions
WHERE group_id = $1
ORDER BY version DESC
LIMIT 1
`

func (q *Queries) GetLatestToolVariationsGroupVersion(ctx context.Context, groupID uuid.UUID) (ToolVariationsGroupVersion, error) {
	row := q.db.QueryRow(ctx, getLatestToolVariationsGroupVersion, groupID)
	var i ToolVariationsGroupVersion
	err := row.Scan(
		&i.ID,
		&i.GroupID,
		&i.Version,
		&i.VariationIds,
		&i.PredecessorID,
		&i.CreatedAt,
	)
	return i, err
}

const getRelease = `-- name: GetRelease :one
SELECT id, toolset_id, source_state_id, toolset_version_id, global_variations_version_id, toolset_variations_version_id, release_number, notes, released_by_user_id, created_at
FROM toolset_releases
WHERE id = $1
`

func (q *Queries) GetRelease(ctx context.Context, id uuid.UUID) (ToolsetRelease, error) {
	row := q.db.QueryRow(ctx, getRelease, id)
	var i ToolsetRelease
	err := row.Scan(
		&i.ID,
		&i.ToolsetID,
		&i.SourceStateID,
		&i.ToolsetVersionID,
		&i.GlobalVariationsVersionID,
		&i.ToolsetVariationsVersionID,
		&i.ReleaseNumber,
		&i.Notes,
		&i.ReleasedByUserID,
		&i.CreatedAt,
	)
	return i, err
}

const getReleaseByNumber = `-- name: GetReleaseByNumber :one
SELECT id, toolset_id, source_state_id, toolset_version_id, global_variations_version_id, toolset_variations_version_id, release_number, notes, released_by_user_id, created_at
FROM toolset_releases
WHERE toolset_id = $1
  AND release_number = $2
`

type GetReleaseByNumberParams struct {
	ToolsetID     uuid.UUID
	ReleaseNumber int64
}

func (q *Queries) GetReleaseByNumber(ctx context.Context, arg GetReleaseByNumberParams) (ToolsetRelease, error) {
	row := q.db.QueryRow(ctx, getReleaseByNumber, arg.ToolsetID, arg.ReleaseNumber)
	var i ToolsetRelease
	err := row.Scan(
		&i.ID,
		&i.ToolsetID,
		&i.SourceStateID,
		&i.ToolsetVersionID,
		&i.GlobalVariationsVersionID,
		&i.ToolsetVariationsVersionID,
		&i.ReleaseNumber,
		&i.Notes,
		&i.ReleasedByUserID,
		&i.CreatedAt,
	)
	return i, err
}

const getSourceState = `-- name: GetSourceState :one
SELECT id, project_id, deployment_id, system_source_state_id, created_at
FROM source_states
WHERE id = $1
`

func (q *Queries) GetSourceState(ctx context.Context, id uuid.UUID) (SourceState, error) {
	row := q.db.QueryRow(ctx, getSourceState, id)
	var i SourceState
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.DeploymentID,
		&i.SystemSourceStateID,
		&i.CreatedAt,
	)
	return i, err
}

const getSourceStateByComponents = `-- name: GetSourceStateByComponents :one
SELECT id, project_id, deployment_id, system_source_state_id, created_at
FROM source_states
WHERE deployment_id = $1
  AND system_source_state_id = $2
LIMIT 1
`

type GetSourceStateByComponentsParams struct {
	DeploymentID        uuid.UUID
	SystemSourceStateID uuid.UUID
}

func (q *Queries) GetSourceStateByComponents(ctx context.Context, arg GetSourceStateByComponentsParams) (SourceState, error) {
	row := q.db.QueryRow(ctx, getSourceStateByComponents, arg.DeploymentID, arg.SystemSourceStateID)
	var i SourceState
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.DeploymentID,
		&i.SystemSourceStateID,
		&i.CreatedAt,
	)
	return i, err
}

const getSystemSourceState = `-- name: GetSystemSourceState :one
SELECT id, project_id, prompt_template_ids, created_at
FROM system_source_states
WHERE id = $1
`

func (q *Queries) GetSystemSourceState(ctx context.Context, id uuid.UUID) (SystemSourceState, error) {
	row := q.db.QueryRow(ctx, getSystemSourceState, id)
	var i SystemSourceState
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.PromptTemplateIds,
		&i.CreatedAt,
	)
	return i, err
}

const getToolVariationsGroupVersion = `-- name: GetToolVariationsGroupVersion :one
SELECT id, group_id, version, variation_ids, predecessor_id, created_at
FROM tool_variations_group_versions
WHERE id = $1
`

func (q *Queries) GetToolVariationsGroupVersion(ctx context.Context, id uuid.UUID) (ToolVariationsGroupVersion, error) {
	row := q.db.QueryRow(ctx, getToolVariationsGroupVersion, id)
	var i ToolVariationsGroupVersion
	err := row.Scan(
		&i.ID,
		&i.GroupID,
		&i.Version,
		&i.VariationIds,
		&i.PredecessorID,
		&i.CreatedAt,
	)
	return i, err
}

const listReleases = `-- name: ListReleases :many
SELECT id, toolset_id, source_state_id, toolset_version_id, global_variations_version_id, toolset_variations_version_id, release_number, notes, released_by_user_id, created_at
FROM toolset_releases
WHERE toolset_id = $1
ORDER BY release_number DESC
LIMIT $3
OFFSET $2
`

type ListReleasesParams struct {
	ToolsetID   uuid.UUID
	OffsetCount int32
	LimitCount  int32
}

func (q *Queries) ListReleases(ctx context.Context, arg ListReleasesParams) ([]ToolsetRelease, error) {
	rows, err := q.db.Query(ctx, listReleases, arg.ToolsetID, arg.OffsetCount, arg.LimitCount)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ToolsetRelease
	for rows.Next() {
		var i ToolsetRelease
		if err := rows.Scan(
			&i.ID,
			&i.ToolsetID,
			&i.SourceStateID,
			&i.ToolsetVersionID,
			&i.GlobalVariationsVersionID,
			&i.ToolsetVariationsVersionID,
			&i.ReleaseNumber,
			&i.Notes,
			&i.ReleasedByUserID,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listToolVariationsGroupVersions = `-- name: ListToolVariationsGroupVersions :many
SELECT id, group_id, version, variation_ids, predecessor_id, created_at
FROM tool_variations_group_versions
WHERE group_id = $1
ORDER BY version DESC
`

func (q *Queries) ListToolVariationsGroupVersions(ctx context.Context, groupID uuid.UUID) ([]ToolVariationsGroupVersion, error) {
	rows, err := q.db.Query(ctx, listToolVariationsGroupVersions, groupID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ToolVariationsGroupVersion
	for rows.Next() {
		var i ToolVariationsGroupVersion
		if err := rows.Scan(
			&i.ID,
			&i.GroupID,
			&i.Version,
			&i.VariationIds,
			&i.PredecessorID,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
