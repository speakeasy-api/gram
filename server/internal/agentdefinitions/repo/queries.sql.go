// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: queries.sql

package repo

import (
	"context"

	"github.com/google/uuid"
	"github.com/speakeasy-api/gram/server/internal/urn"
)

const createAgentDefinition = `-- name: CreateAgentDefinition :one
INSERT INTO agent_definitions (
    organization_id
  , project_id
  , name
  , tool_urn
  , model
  , title
  , description
  , instruction
  , tools
)
VALUES (
    $1
  , $2
  , $3
  , $4
  , $5
  , NULLIF($6, '')
  , $7
  , $8
  , $9
)
RETURNING id, organization_id, project_id, name, tool_urn, model, title, description, instruction, tools, created_at, updated_at, deleted_at, deleted
`

type CreateAgentDefinitionParams struct {
	OrganizationID string
	ProjectID      uuid.UUID
	Name           string
	ToolUrn        urn.Tool
	Model          string
	Title          interface{}
	Description    string
	Instruction    string
	Tools          []urn.Tool
}

func (q *Queries) CreateAgentDefinition(ctx context.Context, arg CreateAgentDefinitionParams) (AgentDefinition, error) {
	row := q.db.QueryRow(ctx, createAgentDefinition,
		arg.OrganizationID,
		arg.ProjectID,
		arg.Name,
		arg.ToolUrn,
		arg.Model,
		arg.Title,
		arg.Description,
		arg.Instruction,
		arg.Tools,
	)
	var i AgentDefinition
	err := row.Scan(
		&i.ID,
		&i.OrganizationID,
		&i.ProjectID,
		&i.Name,
		&i.ToolUrn,
		&i.Model,
		&i.Title,
		&i.Description,
		&i.Instruction,
		&i.Tools,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const deleteAgentDefinition = `-- name: DeleteAgentDefinition :exec
UPDATE agent_definitions
SET deleted_at = clock_timestamp()
WHERE id = $1
  AND project_id = $2
  AND deleted IS FALSE
`

type DeleteAgentDefinitionParams struct {
	ID        uuid.UUID
	ProjectID uuid.UUID
}

func (q *Queries) DeleteAgentDefinition(ctx context.Context, arg DeleteAgentDefinitionParams) error {
	_, err := q.db.Exec(ctx, deleteAgentDefinition, arg.ID, arg.ProjectID)
	return err
}

const getAgentDefinition = `-- name: GetAgentDefinition :one
SELECT id, organization_id, project_id, name, tool_urn, model, title, description, instruction, tools, created_at, updated_at, deleted_at, deleted
FROM agent_definitions
WHERE id = $1
  AND project_id = $2
  AND deleted IS FALSE
`

type GetAgentDefinitionParams struct {
	ID        uuid.UUID
	ProjectID uuid.UUID
}

func (q *Queries) GetAgentDefinition(ctx context.Context, arg GetAgentDefinitionParams) (AgentDefinition, error) {
	row := q.db.QueryRow(ctx, getAgentDefinition, arg.ID, arg.ProjectID)
	var i AgentDefinition
	err := row.Scan(
		&i.ID,
		&i.OrganizationID,
		&i.ProjectID,
		&i.Name,
		&i.ToolUrn,
		&i.Model,
		&i.Title,
		&i.Description,
		&i.Instruction,
		&i.Tools,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const getAgentDefinitionByName = `-- name: GetAgentDefinitionByName :one
SELECT id, organization_id, project_id, name, tool_urn, model, title, description, instruction, tools, created_at, updated_at, deleted_at, deleted
FROM agent_definitions
WHERE name = $1
  AND project_id = $2
  AND deleted IS FALSE
`

type GetAgentDefinitionByNameParams struct {
	Name      string
	ProjectID uuid.UUID
}

func (q *Queries) GetAgentDefinitionByName(ctx context.Context, arg GetAgentDefinitionByNameParams) (AgentDefinition, error) {
	row := q.db.QueryRow(ctx, getAgentDefinitionByName, arg.Name, arg.ProjectID)
	var i AgentDefinition
	err := row.Scan(
		&i.ID,
		&i.OrganizationID,
		&i.ProjectID,
		&i.Name,
		&i.ToolUrn,
		&i.Model,
		&i.Title,
		&i.Description,
		&i.Instruction,
		&i.Tools,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const listAgentDefinitions = `-- name: ListAgentDefinitions :many
SELECT id, organization_id, project_id, name, tool_urn, model, title, description, instruction, tools, created_at, updated_at, deleted_at, deleted
FROM agent_definitions
WHERE project_id = $1
  AND deleted IS FALSE
ORDER BY created_at DESC
`

func (q *Queries) ListAgentDefinitions(ctx context.Context, projectID uuid.UUID) ([]AgentDefinition, error) {
	rows, err := q.db.Query(ctx, listAgentDefinitions, projectID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []AgentDefinition
	for rows.Next() {
		var i AgentDefinition
		if err := rows.Scan(
			&i.ID,
			&i.OrganizationID,
			&i.ProjectID,
			&i.Name,
			&i.ToolUrn,
			&i.Model,
			&i.Title,
			&i.Description,
			&i.Instruction,
			&i.Tools,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.DeletedAt,
			&i.Deleted,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateAgentDefinition = `-- name: UpdateAgentDefinition :one
UPDATE agent_definitions
SET
    model = COALESCE(NULLIF($1, ''), model)
  , title = COALESCE(NULLIF($2, ''), title)
  , description = COALESCE(NULLIF($3, ''), description)
  , instruction = COALESCE(NULLIF($4, ''), instruction)
  , tools = COALESCE($5, tools)
  , updated_at = clock_timestamp()
WHERE id = $6
  AND project_id = $7
  AND deleted IS FALSE
RETURNING id, organization_id, project_id, name, tool_urn, model, title, description, instruction, tools, created_at, updated_at, deleted_at, deleted
`

type UpdateAgentDefinitionParams struct {
	Model       interface{}
	Title       interface{}
	Description interface{}
	Instruction interface{}
	Tools       []urn.Tool
	ID          uuid.UUID
	ProjectID   uuid.UUID
}

func (q *Queries) UpdateAgentDefinition(ctx context.Context, arg UpdateAgentDefinitionParams) (AgentDefinition, error) {
	row := q.db.QueryRow(ctx, updateAgentDefinition,
		arg.Model,
		arg.Title,
		arg.Description,
		arg.Instruction,
		arg.Tools,
		arg.ID,
		arg.ProjectID,
	)
	var i AgentDefinition
	err := row.Scan(
		&i.ID,
		&i.OrganizationID,
		&i.ProjectID,
		&i.Name,
		&i.ToolUrn,
		&i.Model,
		&i.Title,
		&i.Description,
		&i.Instruction,
		&i.Tools,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}
