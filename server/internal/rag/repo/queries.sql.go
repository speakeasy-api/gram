// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: queries.sql

package repo

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
	pgvector_go "github.com/pgvector/pgvector-go"
)

const getToolsetEmbedding = `-- name: GetToolsetEmbedding :one
SELECT id, toolset_id, entry_key, embedding_model, embedding_1536, payload, created_at, updated_at, deleted_at, deleted
FROM toolset_embeddings
WHERE toolset_id = $1
  AND entry_key = $2
  AND deleted IS FALSE
`

type GetToolsetEmbeddingParams struct {
	ToolsetID uuid.UUID
	EntryKey  string
}

func (q *Queries) GetToolsetEmbedding(ctx context.Context, arg GetToolsetEmbeddingParams) (ToolsetEmbedding, error) {
	row := q.db.QueryRow(ctx, getToolsetEmbedding, arg.ToolsetID, arg.EntryKey)
	var i ToolsetEmbedding
	err := row.Scan(
		&i.ID,
		&i.ToolsetID,
		&i.EntryKey,
		&i.EmbeddingModel,
		&i.Embedding1536,
		&i.Payload,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const searchToolsetEmbeddings = `-- name: SearchToolsetEmbeddings :many
SELECT
    id,
    toolset_id,
    entry_key,
    embedding_model,
    payload,
    created_at,
    updated_at,
    1 - (embedding_1536 <=> $1) AS similarity
FROM toolset_embeddings
WHERE toolset_id = $2
  AND deleted IS FALSE
ORDER BY embedding_1536 <=> $1
LIMIT $3
`

type SearchToolsetEmbeddingsParams struct {
	QueryEmbedding1536 pgvector_go.Vector
	ToolsetID          uuid.UUID
	ResultLimit        int32
}

type SearchToolsetEmbeddingsRow struct {
	ID             uuid.UUID
	ToolsetID      uuid.UUID
	EntryKey       string
	EmbeddingModel string
	Payload        []byte
	CreatedAt      pgtype.Timestamptz
	UpdatedAt      pgtype.Timestamptz
	Similarity     int32
}

func (q *Queries) SearchToolsetEmbeddings(ctx context.Context, arg SearchToolsetEmbeddingsParams) ([]SearchToolsetEmbeddingsRow, error) {
	rows, err := q.db.Query(ctx, searchToolsetEmbeddings, arg.QueryEmbedding1536, arg.ToolsetID, arg.ResultLimit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []SearchToolsetEmbeddingsRow
	for rows.Next() {
		var i SearchToolsetEmbeddingsRow
		if err := rows.Scan(
			&i.ID,
			&i.ToolsetID,
			&i.EntryKey,
			&i.EmbeddingModel,
			&i.Payload,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.Similarity,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const upsertToolsetEmbedding = `-- name: UpsertToolsetEmbedding :one
INSERT INTO toolset_embeddings (
    toolset_id,
    entry_key,
    embedding_model,
    embedding_1536,
    payload
) VALUES (
    $1,
    $2,
    $3,
    $4,
    $5
) ON CONFLICT (toolset_id, entry_key)
WHERE deleted IS FALSE
DO UPDATE SET
    embedding_model = EXCLUDED.embedding_model,
    embedding_1536 = EXCLUDED.embedding_1536,
    payload = EXCLUDED.payload,
    updated_at = clock_timestamp(),
    deleted_at = NULL
RETURNING id, toolset_id, entry_key, embedding_model, embedding_1536, payload, created_at, updated_at, deleted_at, deleted
`

type UpsertToolsetEmbeddingParams struct {
	ToolsetID      uuid.UUID
	EntryKey       string
	EmbeddingModel string
	Embedding1536  pgvector_go.Vector
	Payload        []byte
}

func (q *Queries) UpsertToolsetEmbedding(ctx context.Context, arg UpsertToolsetEmbeddingParams) (ToolsetEmbedding, error) {
	row := q.db.QueryRow(ctx, upsertToolsetEmbedding,
		arg.ToolsetID,
		arg.EntryKey,
		arg.EmbeddingModel,
		arg.Embedding1536,
		arg.Payload,
	)
	var i ToolsetEmbedding
	err := row.Scan(
		&i.ID,
		&i.ToolsetID,
		&i.EntryKey,
		&i.EmbeddingModel,
		&i.Embedding1536,
		&i.Payload,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}
