version: "2"
servers:
  - engine: postgresql
    uri: postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=disable
overrides:
  go:
    overrides:
      - db_type: "uuid"
        go_type:
          import: "github.com/google/uuid"
          type: "UUID"
        nullable: false
      - db_type: "uuid"
        go_type:
          import: "github.com/google/uuid"
          type: "NullUUID"
        nullable: true
      - column: http_tool_definitions.response_filter
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/tools/repo/models
          type: ResponseFilter
          pointer: true

sql:
  - schema: schema.sql
    queries: ./stub.sql
    engine: postgresql
    database:
      managed: true
    gen:
      go:
        package: "database"
        out: "../internal/database"
        sql_package: "pgx/v5"
        omit_unused_structs: false

  - schema: schema.sql
    queries: ../internal/testenv/queries.sql
    engine: postgresql
    gen:
      go:
        package: "testrepo"
        out: "../internal/testenv/testrepo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/auth/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/auth/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/deployments/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/deployments/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/packages/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/packages/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/projects/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/projects/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/organizations/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/organizations/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/toolsets/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/toolsets/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/assets/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/assets/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/keys/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/keys/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/environments/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/environments/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/tools/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/tools/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/integrations/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/integrations/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/thirdparty/openrouter/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/thirdparty/openrouter/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/chat/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/chat/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/thirdparty/slack/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/thirdparty/slack/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/variations/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/variations/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/customdomains/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/customdomains/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/templates/queries.sql
    engine: postgresql
    database:
      managed: true
    gen:
      go:
        package: "repo"
        out: "../internal/templates/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/o11y/queries.sql
    engine: postgresql
    database:
      managed: true
    gen:
      go:
        package: "repo"
        out: "../internal/o11y/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/users/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/users/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true
