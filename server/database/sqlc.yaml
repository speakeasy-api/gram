version: "2"
servers:
  - engine: postgresql
    uri: postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=disable
overrides:
  go:
    overrides:
      - db_type: "uuid"
        go_type:
          import: "github.com/google/uuid"
          type: "UUID"
        nullable: false
      - db_type: "uuid"
        go_type:
          import: "github.com/google/uuid"
          type: "NullUUID"
        nullable: true
      - column: http_tool_definitions.response_filter
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/tools/repo/models
          type: ResponseFilter
          pointer: true
      - column: function_tool_definitions.tool_urn
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/urn
          type: Tool
      - column: http_tool_definitions.tool_urn
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/urn
          type: Tool
      - column: prompt_templates.tool_urn
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/urn
          type: Tool
      - column: function_resource_definitions.resource_urn
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/urn
          type: Resource
      - column: toolset_versions.tool_urns
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/urn
          type: Tool
          slice: true
      - column: toolset_versions.resource_urns
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/urn
          type: Resource
          slice: true
      - column: functions_access.encryption_key
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/conv
          type: Secret
      - column: tool_variations.src_tool_urn
        go_type:
          import: github.com/speakeasy-api/gram/server/internal/urn
          type: Tool
      - db_type: "vector"
        go_type:
          import: github.com/pgvector/pgvector-go
          type: Vector

sql:
  - schema: schema.sql
    queries: ./stub.sql
    engine: postgresql
    database:
      managed: true
    gen:
      go:
        package: "database"
        out: "../internal/database"
        sql_package: "pgx/v5"
        omit_unused_structs: false

  - schema: schema.sql
    queries: ../internal/testenv/queries.sql
    engine: postgresql
    gen:
      go:
        package: "testrepo"
        out: "../internal/testenv/testrepo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/auth/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/auth/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/deployments/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/deployments/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/packages/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/packages/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/projects/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/projects/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/organizations/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/organizations/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/toolsets/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/toolsets/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/assets/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/assets/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/keys/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/keys/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/environments/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/environments/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/tools/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/tools/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/integrations/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/integrations/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/productfeatures/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/productfeatures/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/thirdparty/openrouter/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/thirdparty/openrouter/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/chat/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/chat/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/thirdparty/slack/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/thirdparty/slack/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/variations/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/variations/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/customdomains/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/customdomains/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/mcpmetadata/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/mcpmetadata/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/templates/queries.sql
    engine: postgresql
    database:
      managed: true
    gen:
      go:
        package: "repo"
        out: "../internal/templates/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/o11y/queries.sql
    engine: postgresql
    database:
      managed: true
    gen:
      go:
        package: "repo"
        out: "../internal/o11y/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/users/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/users/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/oauth/repo/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/oauth/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/background/activities/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/background/activities/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/usage/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/usage/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/functions/queries.sql
    engine: postgresql
    database:
      managed: true
    gen:
      go:
        package: "repo"
        out: "../internal/functions/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/resources/repo/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/resources/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/rag/repo/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/rag/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true

  - schema: schema.sql
    queries: ../internal/agents/repo/queries.sql
    engine: postgresql
    gen:
      go:
        package: "repo"
        out: "../internal/agents/repo"
        sql_package: "pgx/v5"
        omit_unused_structs: true